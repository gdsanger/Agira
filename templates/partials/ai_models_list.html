{% if error_message %}
<!-- Error notification -->
<div class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
    <strong>❌ Error:</strong> {{ error_message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

{% if sync_info %}
<!-- Sync notification -->
<div class="alert alert-info alert-dismissible fade show mb-3" role="alert">
    <strong>✓ Sync Complete:</strong>
    {% if sync_info.created > 0 %}{{ sync_info.created }} new model(s) added.{% endif %}
    {% if sync_info.updated > 0 %}{{ sync_info.updated }} model(s) updated.{% endif %}
    {% if sync_info.created == 0 and sync_info.updated == 0 and not sync_info.deactivated %}
        All models are up to date.
    {% endif %}
    {% if sync_info.deactivated %}
    <div class="mt-2 alert alert-warning mb-0">
        <strong>⚠️ Models deactivated:</strong> The following models are no longer available in the API and have been deactivated:
        <ul class="mb-0 mt-1">
            {% for model_name in sync_info.deactivated %}
            <li>{{ model_name }}</li>
            {% endfor %}
        </ul>
        <small class="d-block mt-2">Please review and update any AI Agents using these models.</small>
    </div>
    {% endif %}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<script>
// Visual feedback for successful price updates
function showPriceSaveSuccess(element) {
    element.classList.add('border-success');
    setTimeout(() => element.classList.remove('border-success'), 1000);
}
</script>

{% if models %}
<div class="table-responsive">
    <table class="table table-sm">
        <thead>
            <tr>
                <th>Model</th>
                <th>Input Price</th>
                <th>Output Price</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for model in models %}
            <tr>
                <td>
                    <strong>{{ model.name }}</strong>
                    {% if model.is_default %}
                    <span class="badge bg-primary" style="font-size: 0.7rem;">Default</span>
                    {% endif %}
                    <br>
                    <small class="text-muted">{{ model.model_id }}</small>
                </td>
                <td>
                    <input type="number" 
                           step="0.0001" 
                           min="0"
                           class="form-control form-control-sm price-input" 
                           style="max-width: 120px;"
                           value="{{ model.input_price_per_1m_tokens|default:'' }}"
                           hx-post="{% url 'ai-model-update-field' provider.id model.id %}"
                           hx-trigger="blur changed"
                           hx-vals='{"field": "input_price_per_1m_tokens"}'
                           hx-include="this"
                           hx-swap="none"
                           hx-on::after-request="if(event.detail.successful) showPriceSaveSuccess(this)"
                           name="value"
                           placeholder="0.00">
                </td>
                <td>
                    <input type="number" 
                           step="0.0001" 
                           min="0"
                           class="form-control form-control-sm price-input" 
                           style="max-width: 120px;"
                           value="{{ model.output_price_per_1m_tokens|default:'' }}"
                           hx-post="{% url 'ai-model-update-field' provider.id model.id %}"
                           hx-trigger="blur changed"
                           hx-vals='{"field": "output_price_per_1m_tokens"}'
                           hx-include="this"
                           hx-swap="none"
                           hx-on::after-request="if(event.detail.successful) showPriceSaveSuccess(this)"
                           name="value"
                           placeholder="0.00">
                </td>
                <td>
                    <div class="form-check form-switch">
                        <input class="form-check-input" 
                               type="checkbox" 
                               role="switch"
                               {% if model.active %}checked{% endif %}
                               hx-post="{% url 'ai-model-toggle-active' provider.id model.id %}"
                               hx-target="closest tr"
                               hx-swap="outerHTML">
                    </div>
                </td>
                <td>
                    <button type="button" class="btn btn-outline-danger btn-sm"
                            hx-post="{% url 'ai-model-delete' provider.id model.id %}"
                            hx-target="#models-list"
                            hx-confirm="Delete this model?"
                            hx-on::after-request="if(event.detail.successful) showToast('Model deleted', 'success')">
                        Delete
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-4">
    <p class="text-muted">No models configured yet.</p>
    <p class="text-muted">Click "Add Model" or "Fetch Models" to get started.</p>
</div>
{% endif %}
