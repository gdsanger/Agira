{% extends "base.html" %}

{% block title %}Projects - Agira{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1>Projects</h1>
            <p class="text-muted">Manage your projects</p>
        </div>
        <a href="{% url 'project-create' %}" class="btn btn-primary">
            + New Project
        </a>
    </div>
</div>

<!-- Filter Bar -->
<div class="mb-4">
    <form method="get" action="{% url 'projects' %}" class="row g-3">
        <div class="col-md-3">
            <input type="text" name="q" class="form-control" placeholder="Search projects..." value="{{ search_query }}">
        </div>
        <div class="col-md-3">
            <select name="organisation" class="form-select">
                <option value="">All Organisations</option>
                {% for org in organisations %}
                <option value="{{ org.id }}" {% if selected_organisation == org.id|stringformat:"s" %}selected{% endif %}>
                    {{ org.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <select name="status" class="form-select">
                <option value="">All Statuses</option>
                {% for status_value, status_label in statuses %}
                <option value="{{ status_value }}" {% if selected_status == status_value %}selected{% endif %}>
                    {{ status_label }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Filter</button>
            {% if search_query or selected_organisation or selected_status %}
            <a href="{% url 'projects' %}" class="btn btn-secondary">Clear</a>
            {% endif %}
        </div>
    </form>
</div>

<!-- Projects Cards -->
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for project in projects %}
    <div class="col">
        <div class="card h-100" style="cursor: pointer;" onclick="window.location='{% url 'project-detail' project.id %}'">
            <div class="card-body">
                <h5 class="card-title">{{ project.name }}</h5>
                <div class="mb-3">
                    {% if project.status == 'New' %}
                    <span class="badge bg-info">{{ project.status }}</span>
                    {% elif project.status == 'Working' %}
                    <span class="badge bg-primary">{{ project.status }}</span>
                    {% elif project.status == 'Finished' %}
                    <span class="badge bg-success">{{ project.status }}</span>
                    {% elif project.status == 'Canceled' %}
                    <span class="badge bg-secondary">{{ project.status }}</span>
                    {% else %}
                    <span class="badge bg-secondary">{{ project.status }}</span>
                    {% endif %}
                </div>
                
                <!-- Item Counts by Status with Icons -->
                <div class="d-flex flex-wrap gap-2 align-items-center">
                    <span class="badge bg-secondary" title="Inbox" data-bs-toggle="tooltip">
                        ðŸ“¥ {{ project.inbox_count }}
                    </span>
                    <span class="badge bg-secondary" title="Backlog" data-bs-toggle="tooltip">
                        ðŸ“‹ {{ project.backlog_count }}
                    </span>
                    <span class="badge bg-primary" title="Working" data-bs-toggle="tooltip">
                        âš¡ {{ project.working_count }}
                    </span>
                    <span class="badge bg-warning" title="Testing" data-bs-toggle="tooltip">
                        ðŸ§ª {{ project.testing_count }}
                    </span>
                    <span class="badge bg-success" title="Ready for Release" data-bs-toggle="tooltip">
                        âœ… {{ project.ready_for_release_count }}
                    </span>
                </div>
            </div>
            {% if project.github_owner and project.github_repo %}
            <div class="card-footer bg-transparent">
                <small class="text-muted">
                    <a href="https://github.com/{{ project.github_owner }}/{{ project.github_repo }}" target="_blank" onclick="event.stopPropagation();">
                        {{ project.github_owner }}/{{ project.github_repo }}
                    </a>
                </small>
            </div>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            {% if search_query or selected_organisation or selected_status %}
            No projects found matching the current filters.
            {% else %}
            No projects yet.
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize Bootstrap tooltips
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}
